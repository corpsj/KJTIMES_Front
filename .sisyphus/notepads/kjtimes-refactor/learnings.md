- 2026-02-12: middleware has two global redirect levers: PREVIEW_MODE gate and 12h kj_special_issue_lock cookie lock.
- 2026-02-12: local env has NEXT_PUBLIC_PREVIEW_MODE unset, so preview logic is inactive by default.
- 2026-02-12: Task 1 (Admin Auth Middleware) completed successfully.
  - Added isUserAuthenticated() helper function using @supabase/ssr createServerClient
  - Middleware now checks auth before device detection (line 64-73)
  - Uses 307 temporary redirect to /admin/login for unauthenticated /admin/* requests
  - /admin/login remains accessible without auth (exception in middleware)
  - All 3 QA scenarios passed:
    1. Unauthenticated /admin → redirects to /admin/login ✓
    2. /admin/login accessible without auth ✓
    3. /admin/articles (other admin routes) → redirects to /admin/login ✓
  - Build passes with no errors
  - Dual protection: server-side middleware + client-side auth check maintained

- 2026-02-12: Task 2 (Security Exposure Removal + Broken Pages Fix) completed successfully.
  - Admin login page: Changed placeholder from "admin" to "아이디를 입력하세요" (generic Korean text)
    - Eliminates security risk of exposing admin username hints
    - Verified via Playwright snapshot
  - Public site login button: Changed href from /admin/login to /login
    - Readers now directed to correct public login page, not admin interface
    - Verified via Playwright snapshot showing /url: /login
  - Footer copyright: Removed duplicate from mobile section, unified to single version
    - "Copyright © 2026 광전타임즈. All rights reserved." appears on all pages
    - Verified on homepage and all info pages
  - Info pages status: All pages (/about, /advertise, /corrections) render correctly
    - HTTP 200 responses confirmed via curl
    - Playwright navigation confirms no errors
    - Each page has proper Content component (AboutContent, AdvertiseContent, CorrectionsContent)
  - Build status: npm run build PASSED (2.9s, Turbopack)
    - All pages compiled successfully
    - /about, /advertise, /corrections marked as static (○)
  - All 3 QA scenarios passed:
    1. Admin login placeholder removal ✓
    2. Public login button path verification ✓
    3. Info pages HTTP 200 status ✓
  - Files modified: 3 (app/admin/login/page.tsx, components/layout/Header.tsx, components/layout/Footer.tsx)
  - Ready for Task 3 (PREVIEW_MODE cleanup) and Tasks 4+ (Foundation phase)
- 2026-02-12: Task 3 completed - PREVIEW_MODE and SPECIAL_ISSUE_LOCK_COOKIE disabled.
- 2026-02-12: Removed PREVIEW_MODE redirect logic (lines 88-105 in middleware.ts) - no longer redirects / to /special-edition.
- 2026-02-12: Disabled SPECIAL_ISSUE_LOCK_COOKIE 12-hour lock mechanism (lines 107-134 in middleware.ts) - commented out to prevent forced redirects.
- 2026-02-12: Converted search page from server component to client component with Suspense boundary for useSearchParams() hook.
- 2026-02-12: Search page now includes persistent search input - query param from URL populates the search box.
- 2026-02-12: Search query filter verified: .in("status", ["published", "shared"]) includes both published and shared articles.
- 2026-02-12: QA Scenario 1 PASSED: Main page (/) loads without redirect to /special-edition.
- 2026-02-12: QA Scenario 2 PASSED: Search query "TEST" persists in search box after submit, URL shows ?q=TEST, results display correctly.
- 2026-02-12: npm run build passed successfully - no TypeScript or build errors.
- 2026-02-12: Task 4 (Data Access Layer) completed successfully.
  - Created lib/api/ with server/client split:
    - lib/api/articles.ts: Server-only (fetchArticles, fetchArticleById, fetchCategoryArticles, fetchRelatedArticles, fetchArticleTags, fetchSeriesArticlesByTag, incrementArticleViews, uniqueArticlesById)
    - lib/api/articles.client.ts: Browser-only (searchArticlesClient, fetchArticleStats, fetchAdminArticles)
    - lib/api/categories.ts: Server-only (fetchCategories, fetchCategoryBySlug)
    - lib/api/authors.ts: Server-only (fetchAuthorProfile, fetchAuthorArticles)
  - CRITICAL LEARNING: Cannot mix server/client Supabase imports in same file. Next.js 16 Turbopack traces import chains and fails if server-only modules (next/headers) are reachable from client components. Split into .ts (server) and .client.ts (browser) files.
  - ApiResult<T> pattern: { data: T | null; error: Error | null } applied to all new functions.
  - Supabase PromiseLike does NOT support .catch() — must use async/await with try/catch instead of .then().catch() chains.
  - utils/articles.ts converted to deprecated shim re-exporting from lib/api/articles.ts (6 category pages still import from it).
  - Migrated pages: homepage, article detail, special-edition. All render identically.
  - hooks/useArticles.ts: Extracted fetchArticleStats and fetchAdminArticles to lib/api/articles.client.ts. Mutations (status update, delete, clone, bulk) kept in hook due to tight UI state coupling.
  - app/(main)/category/[slug] does not exist — categories use dedicated routes (politics/, economy/, etc.) importing from utils/articles.ts.
  - Build passes, lint clean (no new warnings/errors).
- 2026-02-12: Task 6 (ArticleCard component) completed successfully.
  - Created unified ArticleCard component with 4 variants: featured, compact, list, headline
  - Migrated 4 components to use ArticleCard: MainNews, Headline, PopularNews, CategoryPageTemplate
  - Eliminated ~150 lines of duplicated article rendering code
  - Pattern: variant="featured" (large image top), variant="headline" (medium image top), variant="compact" (horizontal thumbnail right), variant="list" (title only with rank)
  - All components maintain identical visual appearance after migration
  - Build passes, no console errors, homepage renders correctly
  - Evidence: .sisyphus/evidence/task-6-homepage-no-articles.png
- 2026-02-12: Task 7 (ArticleDetail merge) completed successfully.
  - Created unified ArticleDetail component merging Desktop (455 lines) + Mobile (344 lines) → single responsive component (500 lines)
  - Key pattern: Mantine Grid with responsive columns - `<GridCol span={{ base: 12, md: 8 }}>` for main content, `<GridCol span={4} visibleFrom="md">` for sidebar
  - Sidebar hidden on mobile using `visibleFrom="md"` prop - no JavaScript required, pure CSS media queries
  - Mobile breadcrumb shown only on mobile using `hiddenFrom="md"` prop
  - Type conflict resolution: Renamed imported type `ArticleDetail` to `ArticleDetailType` to avoid collision with component name
  - Removed device detection logic from article page - no longer needs `getDeviceType()` or conditional rendering
  - Eliminated ~400 lines of duplicated code between Desktop/Mobile variants
  - Build passes, dev server runs without errors, homepage loads correctly
  - Pattern applies to any Desktop/Mobile component pair: use Mantine responsive props instead of separate components
- 2026-02-12: Task 8 (Header/Footer unification) completed successfully.
  - Created SearchBar component (components/shared/SearchBar.tsx) with 3 variants:
    - variant="desktop": Full search form with TextInput + Button (used in desktop header utility bar)
    - variant="mobile": Icon-only ActionIcon linking to /search page (used in mobile header top bar)
    - variant="drawer": Full search form with leftSection icon (used in mobile drawer menu)
  - Unified Header component (components/layout/Header.tsx) merging Desktop + Mobile patterns:
    - Desktop section: visibleFrom="md" - shows utility bar (date, search, login/subscribe), logo, full navigation bar
    - Mobile section: hiddenFrom="md" - shows compact top bar (burger, logo, search icon, login), horizontal scrollable category nav
    - Mobile Drawer: Mantine Drawer component with search form, category links, utility links (subscribe, about, advertise)
    - Uses useDisclosure hook for drawer state management
    - Active link detection with usePathname for visual feedback (blue highlight, border)
  - Unified Footer component (components/layout/Footer.tsx):
    - Mobile layout: hiddenFrom="sm" - stacked company info, links, copyright
    - Desktop layout: visibleFrom="sm" - side-by-side company info + links
    - Copyright now appears in both mobile and desktop sections (previously missing from mobile)
  - Updated DeviceLayout (components/layout/DeviceLayout.tsx):
    - Removed Box wrappers with visibleFrom/hiddenFrom - no longer needed
    - Removed imports for MobileHeader and MobileFooter
    - Simplified to single Header + children + Footer structure
    - Header and Footer now handle their own responsive behavior internally
  - Eliminated files (no longer imported):
    - components/mobile/MobileHeader.tsx (235 lines) - functionality merged into unified Header
    - components/mobile/MobileFooter.tsx (95 lines) - functionality merged into unified Footer
  - Eliminated ~330 lines of duplicated code
  - Build passes (npm run build: 3.2s, Turbopack)
  - Dev server runs without errors (GET / 200 in 2.9s)
  - Pattern: Single component with visibleFrom/hiddenFrom sections + Drawer for mobile menu
  - Key learning: Mantine responsive props (visibleFrom, hiddenFrom) eliminate need for separate Desktop/Mobile component files
- 2026-02-12: Task 9 (Homepage redesign) completed successfully.
  - Created CategorySection component (components/home/CategorySection.tsx):
    - Props: title, categorySlug, articles
    - Layout: Section title with bottom border + Grid of ArticleCard (variant="compact")
    - Responsive: 4 columns on desktop (md), 2 on tablet (sm), 1 on mobile (base)
    - "더보기" button linking to category page
    - Returns null when no articles (hides empty sections)
  - Unified homepage (app/(main)/page.tsx):
    - Eliminated DesktopMain/MobileMain split - single responsive component
    - Removed device detection (getDeviceType) - CSS-only responsive behavior
    - Korean newspaper layout structure:
      - Featured Headline section (top 3 articles)
      - Main Content Grid: MainNews (8 cols) + PopularNews sidebar (4 cols)
      - Category sections: Politics, Economy, Society (full width, conditional rendering)
    - Responsive pattern: GridCol span={{ base: 12, lg: 8 }} for main, span={{ base: 12, lg: 4 }} for sidebar
    - Sidebar order={{ base: 3, lg: 2 }} - moves below main content on mobile
    - Fetches 30 articles total, 4 per category section
    - Sorts by views for popular section
  - Updated home components to hide when empty:
    - Headline.tsx: Returns null when no mainArticle, hides sub-articles section when empty
    - MainNews.tsx: Returns null when no articles, uses Grid for responsive layout
    - PopularNews.tsx: Returns null when no articles
  - Pattern: Conditional rendering with early return (if (!data) return null) instead of showing "준비 중" messages
  - Build passes (npm run build: 4.8s TypeScript check, 292ms static generation)
  - Key learning: Mantine Stack gap prop only accepts MantineSpacing values, not custom strings like "2rem" in responsive objects
